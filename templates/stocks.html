{% extends "layouts/main.html" %}

{% block head %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.12.4.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

{% endblock %}

{% block content%}


</body>

<form>
    {{ form.autocomp.label }} {{ form.autocomp }}
   <button type="submit">Submit</button>
</form>

{%if ticker_info != None %}

        <div>
            <div id="plotly-stock-candle"></div>
            <script>
                //Parse your Json variable here
                var graphs = {{ plotly_plot | safe }};
                Plotly.plot('plotly-stock-candle', graphs, {});
            </script>
        </div>

        <div class="row">
            <div class="column">
                {{ ticker_info[0]|safe }}
            </div>
            <div class="column">
               {{ ticker_info[1]|safe }}
            </div>
        </div>
{% endif %}

</body>




<script>
        $(function() {
            $.ajax({
                url: '{{ url_for("autocomplete") }}'
                }).done(function (data){
                    $('#stock_autocomplete').autocomplete({
                        source: data,
                        minLength: 3
                    });
                });
            });
</script>

<script>
function handleSubmit(event) {
  event.preventDefault();

  const data = new FormData(event.target);

  const value = Object.fromEntries(data.entries());
  value.topics = data.getAll("autocomp");
  var ticker = value.topics[0];
  var ticker = ticker.split('|')[0].trim();
  var theUrl = "/".concat("stocks/"+ ticker);
  window.location.replace(theUrl);
  console.log( theUrl);
}

const form = document.querySelector('form');
form.addEventListener('submit', handleSubmit);
</script>



{% endblock %}